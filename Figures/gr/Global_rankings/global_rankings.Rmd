---
title: "Global-Rankings"
author: "Ryan O'Dea"
date: "2/9/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)


pacman::p_load(tidyverse,
               gganimate)

```


```{r data-intake}
files <- list.files(path = "tabfolder", pattern = "*.tab", full.names = TRUE)
allfiles.list <- lapply(files, read.csv, header = TRUE)

for (i in 1:14){
  allfiles.list[[i]]$year <- 2005 + i

}

df <- do.call(rbind, allfiles.list)
```

```{r intro-visualization}
#With Mean line
df %>% 
  ggplot(aes(x = ranking)) + 
  geom_histogram(col = "black", fill = "white") + 
  geom_vline(aes(xintercept = mean(ranking)), col = "blue", linetype = "dashed", size = 1) + 
  labs(title = "Distribution of Global Rankings", subtitle = "2006 - 2019", y = "Count", x = "Ranking")

#Mean line and Density
df %>% 
  ggplot(aes(x = ranking)) + 
  geom_histogram(aes(y = ..density..), col = "black", fill = "white") + 
  geom_density(fill = "red", alpha = .2)+
  geom_vline(aes(xintercept = mean(ranking)), col = "blue", linetype = "dashed", size = 1) + 
  labs(title = "Density of Global Rankings", subtitle = "2006 - 2019", y = "Count", x = "Ranking")

#Still-by year
df %>% 
  ggplot(aes(x = ranking)) + 
  geom_histogram(col = "black", fill = "white") + 
  labs(title = "Distribution of Global Rankings", y = "Count", x = "Ranking") +
  facet_wrap(df$year)

#Animation
anim <- df %>% 
  ggplot(aes(x = ranking)) + 
  geom_histogram(col = "black", fill = "white") + 
  labs(title = "Distribution of Global Rankings", subtitle = "{closest_state}", y = "Count", x = "Ranking") + 
  transition_states(year, transition_length = 3, state_length = 10)

#animate(anim, duration = 10, fps = 30, width = 2000, height = 2000, res = 300, renderer = gifski_renderer(loop = F))
#anim_save("Global_rankings.gif")

```

```{r developing-'TS'}
bin.subset <- subset(df, year == 2006)
breaks <- c(0, 20, 40, 60, 80, 100, 120)
labels <- c("(0-20]", "(20-40]", "(40-60]", "(60-80]", "(80-100]", "(100-120]")

bin.subset$group <- cut(bin.subset$ranking,
                        breaks = breaks,
                        include.lowest = TRUE,
                        right = FALSE,
                        labels = labels)

id.var <- bin.subset[c("country", "group")]

grouping.df <- merge(df, id.var, by = "country")
```

